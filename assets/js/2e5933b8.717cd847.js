"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[9278],{6486:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>d,frontMatter:()=>i,metadata:()=>n,toc:()=>h});const n=JSON.parse('{"id":"Setup and Deployment/rotatingkeysets","title":"Plan to Rotate Keysets and Crop the Database","description":"Every ecash transaction your users make will leave entries in your database so that your mint can remember which ecash has been spent before. That means that, in the most basic case, your database\'s size will grow indefinitely, which is obviously not a sustainable state of affairs. This growth is fairly small and I have seen a Nutshell database grow to a mere size of a few dozen MB over a course of more than a year of usage.","source":"@site/docs/03-Setup and Deployment/rotatingkeysets.md","sourceDirName":"03-Setup and Deployment","slug":"/Setup and Deployment/rotatingkeysets","permalink":"/cashu-mint-docs/docs/Setup and Deployment/rotatingkeysets","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Deploy Your Mint","permalink":"/cashu-mint-docs/docs/Setup and Deployment/deploymint"},"next":{"title":"Upgrading Your Mint","permalink":"/cashu-mint-docs/docs/Setup and Deployment/upgrading"}}');var s=a(4848),o=a(8453);const i={sidebar_position:2},r="Plan to Rotate Keysets and Crop the Database",l={},h=[{value:"About Keysets",id:"about-keysets",level:2},{value:"Rotating Keysets",id:"rotating-keysets",level:2},{value:"Cropping the Database",id:"cropping-the-database",level:2}];function c(e){const t={a:"a",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"plan-to-rotate-keysets-and-crop-the-database",children:"Plan to Rotate Keysets and Crop the Database"})}),"\n",(0,s.jsx)(t.p,{children:"Every ecash transaction your users make will leave entries in your database so that your mint can remember which ecash has been spent before. That means that, in the most basic case, your database's size will grow indefinitely, which is obviously not a sustainable state of affairs. This growth is fairly small and I have seen a Nutshell database grow to a mere size of a few dozen MB over a course of more than a year of usage."}),"\n",(0,s.jsx)(t.p,{children:"However, we would like to be able to use ecash until the heat death of the universe, and that's why there is a nice strategy to keep the size of your database constant over a long time which is keyset rotations."}),"\n",(0,s.jsx)(t.h2,{id:"about-keysets",children:"About Keysets"}),"\n",(0,s.jsx)(t.p,{children:"Every mint has a private key from which it derives its keysets. A keyset is the set of private keys used to sign the ecash. Inside a Cashu token, you can see the fingerprint (or ID) of the keyset with which it was signed."}),"\n",(0,s.jsxs)(t.p,{children:["As mentioned in ",(0,s.jsx)(t.a,{href:"https://gist.github.com/callebtc/ed5228d1d8cbaade0104db5d1cf63939",children:'"A Proof of Liabilities Scheme for Ecash Mints"'}),", we can keep the size of the database constant by rotating to a new keyset epoch once every few months or a year. A keyset rotation will create a new keyset and new ecash signed with this new keyset will have a different keyset ID. You can imagine it like opening a new ecash counter from which users are served from now on. Ecash from an older keysets will still be accepted but only be exchanged for ecash from the new keyset. That way, ecash from the old epoch will slowly be taken out of circulation (once it is spent) and after a while, there will be only ecash from the new epoch. Once all (or almost all, you can't force dead users to spend their ecash) of the old ecash has been spent and replaced by ecash from the new epoch, you can delete that part of the database that remembered the ecash from the old epoch (to prevent its double spending). That way, a mint operator can regularly reduce the size of the mint's database which allows you to run the mint forever."]}),"\n",(0,s.jsx)(t.h2,{id:"rotating-keysets",children:"Rotating Keysets"}),"\n",(0,s.jsx)(t.p,{children:"Note: We are currently developing mint management that enables keyset rotation and it will no longer be a manual process."}),"\n",(0,s.jsx)(t.p,{children:"Currently, to rotate to a new keyset in Nutshell (version 0.15.3 as of this writing), you increment the derivation path in the config of the mint and restart it."}),"\n",(0,s.jsx)(t.p,{children:"To rotate keysets, there are currently two steps:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"You would change the derivation from m/0'/0'/0' to m/0'/0'/1' to rotate to the new keyset."}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"To prevent minting of ecash from an old keyset, you also need to set that keyset inactive.  Currently, this is only possible manually by finding the keyset in the mint's database, and marking the column active as false."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"Now, only ecash from the new epoch (m/0'/0'/1') will be allowed to be minted and all ecash from the old epoch (m/0'/0'/0') will be slowly taken out of circulation."}),"\n",(0,s.jsx)(t.h2,{id:"cropping-the-database",children:"Cropping the Database"}),"\n",(0,s.jsx)(t.p,{children:"There is currently also no automated way to crop your database and get rid of the old spent table in Nutshell so this step also needs to be done manually as of this writing. However, since this is a vital part of running a sustainable mint, all this will be automated soon such that manual intervention with the database won't be necessary anymore and all of this will simply be possible by changing the configuration of the mint. More updates on this soon. For now, I'll leave you with an outlook and a clear path for an automated solution, and the option to do it manually in case it will be necessary in the short-term."})]})}function d(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453:(e,t,a)=>{a.d(t,{R:()=>i,x:()=>r});var n=a(6540);const s={},o=n.createContext(s);function i(e){const t=n.useContext(o);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),n.createElement(o.Provider,{value:t},e.children)}}}]);