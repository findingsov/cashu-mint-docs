<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Setup and Deployment/rotatingkeysets" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Plan to Rotate Keysets and Crop the Database | Cashu Mint Docs Best Practices</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://findingsov.github.io/cashu-mint-docs/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://findingsov.github.io/cashu-mint-docs/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://findingsov.github.io/cashu-mint-docs/docs/Setup and Deployment/rotatingkeysets"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Plan to Rotate Keysets and Crop the Database | Cashu Mint Docs Best Practices"><meta data-rh="true" name="description" content="Every ecash transaction your users make will leave entries in your database so that your mint can remember which ecash has been spent before. That means that, in the most basic case, your database&#x27;s size will grow indefinitely, which is obviously not a sustainable state of affairs. This growth is fairly small and I have seen a Nutshell database grow to a mere size of a few dozen MB over a course of more than a year of usage."><meta data-rh="true" property="og:description" content="Every ecash transaction your users make will leave entries in your database so that your mint can remember which ecash has been spent before. That means that, in the most basic case, your database&#x27;s size will grow indefinitely, which is obviously not a sustainable state of affairs. This growth is fairly small and I have seen a Nutshell database grow to a mere size of a few dozen MB over a course of more than a year of usage."><link data-rh="true" rel="icon" href="/cashu-mint-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://findingsov.github.io/cashu-mint-docs/docs/Setup and Deployment/rotatingkeysets"><link data-rh="true" rel="alternate" href="https://findingsov.github.io/cashu-mint-docs/docs/Setup and Deployment/rotatingkeysets" hreflang="en"><link data-rh="true" rel="alternate" href="https://findingsov.github.io/cashu-mint-docs/docs/Setup and Deployment/rotatingkeysets" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Plan to Rotate Keysets and Crop the Database","item":"https://findingsov.github.io/cashu-mint-docs/docs/Setup and Deployment/rotatingkeysets"}]}</script><link rel="alternate" type="application/rss+xml" href="/cashu-mint-docs/blog/rss.xml" title="Cashu Mint Docs Best Practices RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/cashu-mint-docs/blog/atom.xml" title="Cashu Mint Docs Best Practices Atom Feed"><link rel="stylesheet" href="/cashu-mint-docs/assets/css/styles.66c3a53b.css">
<script src="/cashu-mint-docs/assets/js/runtime~main.5682a246.js" defer="defer"></script>
<script src="/cashu-mint-docs/assets/js/main.aa1fc295.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="theme-announcement-bar announcementBar_mb4j" style="background-color:#18181b;color:#fafafa" role="banner"><div class="content_knG7 announcementBarContent_xLdY">We’re actively building these docs—check back for updates.</div></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/cashu-mint-docs/"><div class="navbar__logo"><img src="/cashu-mint-docs/img/Cashume.png" alt="Cashu-Mint Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/cashu-mint-docs/img/Cashume.png" alt="Cashu-Mint Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Cashu Mint Best Practices Documentation</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cashu-mint-docs/docs/Introduction/getting_started">Docs</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/findingsov/cashu-mint-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/cashu-mint-docs/docs/Introduction/getting_started">Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/cashu-mint-docs/docs/Lightning/lightning">Lightning</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/cashu-mint-docs/docs/Setup and Deployment/configuremint">Setup and Deployment</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cashu-mint-docs/docs/Setup and Deployment/configuremint">Configuring Your Mint</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cashu-mint-docs/docs/Setup and Deployment/deploymint">Deploy Your Mint</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/cashu-mint-docs/docs/Setup and Deployment/rotatingkeysets">Plan to Rotate Keysets and Crop the Database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cashu-mint-docs/docs/Setup and Deployment/upgrading">Upgrading Your Mint</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cashu-mint-docs/docs/Setup and Deployment/changingminturl">Changing URLs of a MInt</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cashu-mint-docs/docs/Setup and Deployment/shuttingdownmint">Shutting Down a Mint</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cashu-mint-docs/docs/Setup and Deployment/migration">Migrating Your Mint</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/cashu-mint-docs/docs/Backups/backingup">Backups</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/cashu-mint-docs/docs/Security/limitingaccessmint">Security</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/cashu-mint-docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Setup and Deployment</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Plan to Rotate Keysets and Crop the Database</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Plan to Rotate Keysets and Crop the Database</h1></header>
<p>Every ecash transaction your users make will leave entries in your database so that your mint can remember which ecash has been spent before. That means that, in the most basic case, your database&#x27;s size will grow indefinitely, which is obviously not a sustainable state of affairs. This growth is fairly small and I have seen a Nutshell database grow to a mere size of a few dozen MB over a course of more than a year of usage.</p>
<p>However, we would like to be able to use ecash until the heat death of the universe, and that&#x27;s why there is a nice strategy to keep the size of your database constant over a long time which is keyset rotations.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="about-keysets">About Keysets<a href="#about-keysets" class="hash-link" aria-label="Direct link to About Keysets" title="Direct link to About Keysets">​</a></h2>
<p>Every mint has a private key from which it derives its keysets. A keyset is the set of private keys used to sign the ecash. Inside a Cashu token, you can see the fingerprint (or ID) of the keyset with which it was signed.</p>
<p>As mentioned in <a href="https://gist.github.com/callebtc/ed5228d1d8cbaade0104db5d1cf63939" target="_blank" rel="noopener noreferrer">&quot;A Proof of Liabilities Scheme for Ecash Mints&quot;</a>, we can keep the size of the database constant by rotating to a new keyset epoch once every few months or a year. A keyset rotation will create a new keyset and new ecash signed with this new keyset will have a different keyset ID. You can imagine it like opening a new ecash counter from which users are served from now on. Ecash from an older keysets will still be accepted but only be exchanged for ecash from the new keyset. That way, ecash from the old epoch will slowly be taken out of circulation (once it is spent) and after a while, there will be only ecash from the new epoch. Once all (or almost all, you can&#x27;t force dead users to spend their ecash) of the old ecash has been spent and replaced by ecash from the new epoch, you can delete that part of the database that remembered the ecash from the old epoch (to prevent its double spending). That way, a mint operator can regularly reduce the size of the mint&#x27;s database which allows you to run the mint forever.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="rotating-keysets">Rotating Keysets<a href="#rotating-keysets" class="hash-link" aria-label="Direct link to Rotating Keysets" title="Direct link to Rotating Keysets">​</a></h2>
<p>Note: We are currently developing mint management that enables keyset rotation and it will no longer be a manual process.</p>
<p>Currently, to rotate to a new keyset in Nutshell (version 0.15.3 as of this writing), you increment the derivation path in the config of the mint and restart it.</p>
<p>To rotate keysets, there are currently two steps:</p>
<ol>
<li>
<p>You would change the derivation from m/0&#x27;/0&#x27;/0&#x27; to m/0&#x27;/0&#x27;/1&#x27; to rotate to the new keyset.</p>
</li>
<li>
<p>To prevent minting of ecash from an old keyset, you also need to set that keyset inactive.  Currently, this is only possible manually by finding the keyset in the mint&#x27;s database, and marking the column active as false.</p>
</li>
</ol>
<p>Now, only ecash from the new epoch (m/0&#x27;/0&#x27;/1&#x27;) will be allowed to be minted and all ecash from the old epoch (m/0&#x27;/0&#x27;/0&#x27;) will be slowly taken out of circulation.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="cropping-the-database">Cropping the Database<a href="#cropping-the-database" class="hash-link" aria-label="Direct link to Cropping the Database" title="Direct link to Cropping the Database">​</a></h2>
<p>There is currently also no automated way to crop your database and get rid of the old spent table in Nutshell so this step also needs to be done manually as of this writing. However, since this is a vital part of running a sustainable mint, all this will be automated soon such that manual intervention with the database won&#x27;t be necessary anymore and all of this will simply be possible by changing the configuration of the mint. More updates on this soon. For now, I&#x27;ll leave you with an outlook and a clear path for an automated solution, and the option to do it manually in case it will be necessary in the short-term.</p></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/cashu-mint-docs/docs/Setup and Deployment/deploymint"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Deploy Your Mint</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/cashu-mint-docs/docs/Setup and Deployment/upgrading"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Upgrading Your Mint</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#about-keysets" class="table-of-contents__link toc-highlight">About Keysets</a></li><li><a href="#rotating-keysets" class="table-of-contents__link toc-highlight">Rotating Keysets</a></li><li><a href="#cropping-the-database" class="table-of-contents__link toc-highlight">Cropping the Database</a></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>